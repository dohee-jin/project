# 📅 2025-09-22

> **트로피칼** 프로젝트

## 🧭 오늘 작업한 주요 내용

* 스몰토크 프론트엔드 기능 개발 

## 🚩 내일 작업할 내용

* 프로젝트 발표, ppt, 산출물 작성

---

## ✅ 스몰토크 프론트엔드 기능 개발 

* **프론트엔드 <-> 백엔드 연결**   
    * hook으로 백엔드 API 연결
        ```
        import {useCallback, useState} from "react";
        import {apiMethods} from "../../services/api.js";

        export const useSmalltalk = () => {
            const [smallTalkData, setSmallTalkData] = useState([]);

            const fetchSmalltalk = useCallback(async () => {
                try {
                    const res = await apiMethods.get('/smalltalk');
                    if (res.data.success) {
                        const data = res.data.data.topics || [];
                        setSmallTalkData(data);
                    } else {
                        console.warn('API 호출 실패 메시지:', res.data.message);
                    }
                } catch (err) {
                    if (err.response) {
                        const { status, data } = err.response;
                        if (status === 401) {
                            console.warn('로그인 필요:', data?.message);
                        } else {
                            console.error('서버 에러:', status, data?.message);
                        }
                    } else {
                        console.error('네트워크 에러 또는 요청 실패', err);
                    }
                }
            }, []);

            return { smallTalkData, fetchSmalltalk };
        };
        ```
    * LeftLayout에서 hook을 사용하여 API 호출
        ```
        import React, {useEffect} from 'react';
        import LeftHeader from "../components/common/LeftHeader.jsx";
        import {container, leftLayout} from '../styles/layouts/Layout.module.scss';
        import SmallTalkList from "../components/smalltalk/SmallTalkList.jsx";
        import Tips from "../components/smalltalk/Tips.jsx";
        import {useSmalltalk} from "../hooks/smalltalk/useSmalltalk.js";
        import useAuthStore from "../store/authStore.js";

        const LeftLayout = () => {
            const {smallTalkData, fetchSmalltalk} = useSmalltalk();
            const nickname = useAuthStore(state => state.user?.nickname);

            useEffect(() => {
                fetchSmalltalk();
                // ---- 테스트, 배포 시 삭제
                const intervalId = setInterval(() => {
                    try {
                        fetchSmalltalk();
                        console.log("새로운 주제 로드!");
                    } catch (e) {
                        console.error("fetch 실패:", e);
                    }}, 60000);
                return () => clearInterval(intervalId);
                // ---- 테스트, 배포 시 삭제
            }, [fetchSmalltalk]);

            return (
                <div className={leftLayout}>
                    <LeftHeader name={nickname}/>
                    <div className={container}>
                        <SmallTalkList talks= {smallTalkData}/>
                        <Tips />
                    </div>
                </div>
            );
        };

        export default LeftLayout;
        ```
    * LeftHeader에서 props로 전달받은 사용자 정보 뿌리기, 로그아웃 기능 추가
        * 사용자 정보 뿌리기 
            ```
            const {logo, title, userName, desc, leftHeader} = styles;

            const LeftHeader = ({name}) => {
                console.log()
                return (
                    <header className={leftHeader}>
                        <h1 className={logo}></h1>
                        <h2 className={title}>안녕하세요, <span className={userName}>{name}</span>님</h2>
                        <p className={desc}>{name}님의 캘린터, 일기, 버킷리스트, 투두리스트 기반으로 스몰토크 주제를 추천드리겠습니다.</p>
                        <button><HiLogout /></button>
                    </header>
                );
            };
            ```
        * 로그아웃 기능 추가
            ```
            ...
            import {logout} from "../../services/api.js";

            const LeftHeader = ({name}) => {
                const nav= useNavigate();
                const logoutHandler = async (e) => {
                    if(confirm("로그아웃 하시겠습니까?")) {
                        useAuthStore.setState({ user: null, isLoggedIn: false });
                        await logout();
                        nav('/');
                    }
                }
                return (
                    <header className={leftHeader}>
                        <h1 className={logo}></h1>
                        <h2 className={title}>안녕하세요, <span className={userName}>{name}</span>님</h2>
                        <p className={desc}>{name}님의 캘린터, 일기, 버킷리스트, 투두리스트 기반으로 스몰토크 주제를 추천드리겠습니다.</p>
                        <button onClick={logoutHandler}><HiLogout/></button>
                    </header>
                );
            };
            ```
        * 조회해온 스몰토크 렌더링   
        현재 스몰토크가 렌더링 되는 곳은 LeftLayout > SmallTalkList > SmallTalkItem 뿐으로 Zustand를 통한 상태관리 대신 props로 값들을 렌더링하고 전달한다.
            * SmallTalkList   
            LeftLayout에서 props로 건네 받은 값들을 다시 SmallTalkItem에게 전달한다. 
                ```
                const SmallTalkList = ({talks}) => {
                    return (
                        <ul className={container}>
                            {
                                talks.map(talk =>
                                    <>
                                    <SmallTalkItem key={talk.id} type={talk.topicType} content={talk.topicContent} question={talk.exampleQuestion}/>
                                    </>
                                )
                            }
                        </ul>
                    );
                };
                ```
            * SmallTalkItem
                ```
                const SmallTalkItem = ({content, question, type}) => {
                    const topicStyles = {
                        DAILY: { icon: `${dailyIcon}`, color: '#FFF2E1' },
                        INTEREST: { icon: `${dailyIcon}`, color: '#E1F5F7' },
                        FOOD: { icon: `${foodIcon}`, color: '#FFE8F1' },
                        CREATIVE: { icon: `${creativeIcon}`, color: '#F2E8FF' },
                        THOUGHT: { icon: `${thoughtIcon}`, color: '#E8F7E1' },
                        DEFAULT: { icon:`${defaultIcon}`, color: '#FFF2E1' }
                    };

                    const currentStyle = topicStyles[type] || topicStyles.DEFAULT;
                    const icon = currentStyle.icon;


                    return (
                        <li style={{ backgroundColor: currentStyle.color }}>
                            <i>
                                <img src={icon} alt={`${type} icon`} />
                            </i>
                            <p className={desc}>{content}</p>
                            <p className={smallTalk}>{question}</p>
                        </li>
                    );
                };
                ```

---

## 💭 9/22 일 회고   
백엔드 기능 개발 후 프론트엔드 개발을 진행했다. 백엔드 로직을 잘 만들어둬서 프론트엔드는 쉽게 개발을 완료할 수 있었다. 스몰토크 화면은 왼쪽에 고정된 레이아웃과 전역 상태관리가 필요없어서 빠르게 프론트엔드를 완성할 수 있었다. 그래도 API 호출, 스몰토크 주제별 구분 등 생각해야 될 부분이 많아서 조금 해맸지만 2주간의 프로젝트, 맡은 기능이 잘 동작됨을 확인할 수 있어서 뿌듯하다.