# ğŸ“… 2025-08-14 íšŒê³ 

> **ë¶ì ë¶ì (BookJuk)** í”„ë¡œì íŠ¸ ë§ˆì´í˜ì´ì§€ ì •ë³´ ì¡°íšŒ api controller ì‘ì„± ë° api í¬ìŠ¤íŠ¸ë§¨ í…ŒìŠ¤íŠ¸

## ğŸ§­ ì˜¤ëŠ˜ ë…¼ì˜í•œ ì£¼ìš” ë‚´ìš©

* ë§ˆì´í˜ì´ì§€ ì •ë³´ ì¡°íšŒ api controller ì‘ì„±

## ğŸš© ë‚´ì¼ ì‘ì—…í•  ë‚´ìš©

* ì¢‹ì•„ìš” ê¸°ëŠ¥ êµ¬í˜„ ì»¨íŠ¸ë¡¤ëŸ¬ ì‘ì„±
* ë§ˆì´í˜ì´ì§€ ê¸°ëŠ¥ êµ¬í˜„ì„ ìœ„í•œ dto, service ì‘ì—… ì‹œì‘

---

## âœ… ë§ˆì´í˜ì´ì§€ ì •ë³´ ì‘ë‹µ DTO ìƒì„±
ë§ˆì´í˜ì´ì§€ëŠ” ìœ ì €ì •ë³´, ìœ ì €ê°€ ì°¸ì—¬í•œ(í˜¸ìŠ¤íŠ¸, ì°¸ì—¬ì) ëª¨ì„ ì •ë³´, í†µê³„ ì •ë³´(ì°¸ì—¬ ëª¨ì„ ìˆ˜, ë°›ì€ ì¢‹ì•„ìš” ìˆ˜)ë¥¼ í•œë²ˆì— ì‘ë‹µ ë°›ì•„ì•¼ í•˜ì—¬ UserInfoDto, MeetingDto, StaticsInfoDto 3ê°œì™€, 3ê°œì˜ dtoë¥¼ ê°ìŒ€ MyPageResponse Dtoë¥¼ ìƒì„±í–ˆë‹¤. 
```
MyPageResponse dto
public class MyPageResponse {


    private UserInfoDto profile;
    private StaticsInfoDto statistics;
    private List<MeetingInfoDto> meetings;


    // ë§ˆì´í˜ì´ì§€ ì‘ë‹µ dtoë¡œ ë°”ê¾¸ëŠ” ì •ì  íŒ©í† ë¦¬ ë©”ì†Œë“œ
    public static MyPageResponse of(UserInfoDto profile, StaticsInfoDto statistics, List<MeetingInfoDto> meetings) {

        return MyPageResponse.builder()
                .profile(profile)
                .statistics(statistics)
                .meetings(meetings)
                .build();
    }
}

UserInfoDto dto
public class UserInfoDto {

    // ìœ ì € ì •ë³´
    private String username;
    private String email;
    private String profileImage;
    private String preferredGenre;
    private String introduction;

    // ìœ ì € ê°ì²´ë¥¼ MyPage ìµœìƒìœ„ ì‘ë‹µ dtoë¡œ ë³´ë‚´ê¸° ìœ„í•œ ì¤‘ê°„ ì •ì  íŒ©í† ë¦¬ ë©”ì†Œë“œ
    public static UserInfoDto from(User user) {
        return UserInfoDto.builder()
                .username(user.getUsername())
                .email(user.getEmail())
                .profileImage(user.getProfileImage())
                .preferredGenre(user.getPreferredGenre())
                .introduction(user.getIntroduction())
                .build();
    }
}

MeetingInfoDto dto
public class MeetingInfoDto {

    // ëª¨ì„ ì •ë³´
    private Long meetingId;
    private String meetingTitle;
    private LocalDateTime meetingTime;
    private MeetingStatus meetingStatus;
    private ParticipantRole role;
    private Map<String, String> book;

    public static MeetingInfoDto from(MeetingParticipant meetingParticipant) {
        Meeting meeting = meetingParticipant.getMeeting();

        Map<String, String> bookMap = new HashMap<>();
        bookMap.put("title", meeting.getBookTitle());
        bookMap.put("author", meeting.getBookAuthor());

        return MeetingInfoDto.builder()
                .meetingId(meeting.getId())
                .meetingTitle(meeting.getTitle())
                .meetingTime(meeting.getMeetingTime())
                .meetingStatus(meeting.getMeetingStatus())
                .role(meetingParticipant.getRole())
                .book(bookMap)
                .build();

    }
}

StaticsInfoDto dto
public class StaticsInfoDto {

    private Long receivedLikes;
    private int participatedMeeting;

    public static StaticsInfoDto of(Long likes, int meetings) {
        return StaticsInfoDto.builder()
                .receivedLikes(likes)
                .participatedMeeting(meetings)
                .build();
    }

}
```

## âœ… ë§ˆì´í˜ì´ì§€ service ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‘ì„±

ë§ˆì´í˜ì´ì§€ëŠ” ì—¬ëŸ¬ ì •ë³´ë¥¼ í•œ ë²ˆì— ê°€ì ¸ì˜¤ê³  ìˆì–´ ê°ê°ì˜ ì •ë³´ë¥¼ ì¡°íšŒí•´ì˜¤ëŠ” ë©”ì†Œë“œë¥¼ ë§Œë“¤ê³     
í° ë©”ì†Œë“œë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ í° ë©”ì†Œë“œë§Œ ë¶ˆëŸ¬ì™€ë„ ìœ ì €, ì°¸ì—¬ ëª¨ì„, í†µê³„ ì •ë³´ë¥¼ ë‹¤ ë°›ì„ ìˆ˜ ìˆê²Œ ë§Œë“¤ì—ˆë‹¤.
```
public class MyPageService {

    // ì˜ì¡´ ê°ì²´ ì£¼ì…
    private final UserRepository userRepository;
    private final MeetingRepository meetingRepository;
    private final MeetingReviewRepository meetingReviewRepository;
    private final MeetingParticipantRepository meetingParticipantRepository;
    private final LocalFileService localFileService;

    /**
     * ë§ˆì´í˜ì´ì§€ ì§„ì… ì •ë³´ ì¡°íšŒ(ë””í´íŠ¸) ë¡œì§ì…ë‹ˆë‹¤.
     * @param email - ë¡œê·¸ì¸í•œ ìœ ì €ê°€ ì œì‹œí•œ í† í°ì—ì„œ íŒŒì‹±í•œ ì´ë©”ì¼ ì •ë³´
     * @return - í”„ë¡ íŠ¸ ë‹¨ì— ì „ë‹¬í•  ìœ ì € ì •ë³´, ìœ ì € ëª¨ì„ ì •ë³´, ìœ ì €ì˜ ëª¨ì„ ì°¸ì—¬, ì¢‹ì•„ìš” í†µê³„ ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
     */
    public MyPageResponse getMyPage(String email) {

        // 1. ì‚¬ìš©ì ì´ë©”ì¼ë¡œ ìœ ì € ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        User user = getUserByEmail(email);

        // ì¡°íšŒëœ ìœ ì € ì •ë³´ë¥¼ ë§ˆì´í˜ì´ì§€ ì‘ë‹µì— í•„ìš”í•œ dto ë¡œ ë³€ê²½
        UserInfoDto profile = UserInfoDto.from(user);

        // 2. ìœ ì €ê°€ ì°¸ì—¬í•œ ëª¨ì„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        // meeting_participant ì— ìœ ì € idë¡œ ì°¸ì—¬ ëª¨ì„ idë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜
        Long userId = user.getId();
        List<MeetingInfoDto> meetings = getMeetingsByUserId(userId);

        // 3. ìœ ì €ì˜ ëª¨ì„ ì°¸ì—¬, ì¢‹ì•„ìš” í†µê³„ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê¸°
        int meetingCount = meetings.size();
        StaticsInfoDto stats = getStatsByUserId(userId, meetingCount);

        return MyPageResponse.of(profile, stats, meetings);

    }

    /**
     * ì‚¬ìš©ìì˜ email ì •ë³´ë¡œ user ê°ì²´ë¥¼ ê°€ì ¸ì˜¬ ë•Œ ì‚¬ìš©í•˜ëŠ” ë©”ì†Œë“œì…ë‹ˆë‹¤.
     * @param email - ë¡œê·¸ì¸í•œ ìœ ì €ê°€ ì œì‹œí•œ í† í°ì—ì„œ íŒŒì‹±í•œ ì´ë©”ì¼ ì •ë³´
     * @return User - ì¼ì¹˜í•˜ëŠ” ì‚¬ìš©ì ì •ë³´ê°€ ìˆìœ¼ë©´ í•´ë‹¹ User ê°ì²´ë¥¼ ë°˜í™˜, ì—†ìœ¼ë©´ ì»¤ìŠ¤í…€ ì—ëŸ¬ë¥¼ ë°˜í™˜
     */
    private User getUserByEmail(String email) {
        return userRepository.findByEmail(email).orElseThrow(
                () -> new CustomException(ErrorCode.USER_NOT_FOUND)
        );
    }

    /**
     * ì‚¬ìš©ìì˜ id ì •ë³´ë¡œ ì°¸ì—¬í•œ ë¯¸íŒ… ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê³  í•„ìš”í•œ ì •ë³´ë§Œ ë°˜í™˜í•˜ëŠ” ë©”ì†Œë“œì…ë‹ˆë‹¤.
     * @param id - ì´ë©”ì¼ ì •ë³´ë¡œ ì°¾ì€ ìœ ì €ì˜ id
     * @return - ìœ ì €ì˜ id ë¡œ ì°¸ì—¬í•œ ë¯¸íŒ… ì •ë³´ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ë°›ì€ í›„ í•„ìš”í•œ ì •ë³´ë§Œ dto ë¡œ ë§¤í•‘í•œ ë¦¬ìŠ¤íŠ¸
     */
    private List<MeetingInfoDto> getMeetingsByUserId(Long id) {
        // ì‚¬ìš©ì id ì •ë³´ë¡œ ì°¸ì—¬í•œ ë¯¸íŒ… ì •ë³´ ë°˜í™˜
        List<MeetingParticipant> meetingParticipants =
                meetingParticipantRepository.findMeetingsByUserId(id);

        // ë°˜í™˜ëœ ë¦¬ìŠ¤íŠ¸ë¥¼ for ëŒë ¤ì„œ dto ë¡œ ë§¤í•‘
        return meetingParticipants
                .stream()
                .map(meeting -> MeetingInfoDto.from(meeting))
                .collect(Collectors.toList());

    }

    /**
     * ì‚¬ìš©ìì˜ id ì •ë³´ë¡œ ë°›ì€ ì¢‹ì•„ìš” ê°œìˆ˜ë¥¼ ì¡°íšŒí•˜ê³  ì°¸ì—¬í•œ ë¦¬ìŠ¤íŠ¸ ê°œìˆ˜ì™€ í•¨ê»˜ í•„ìš”í•œ ì •ë³´ë§Œ ë°˜í™˜í•˜ëŠ” ë©”ì†Œë“œì…ë‹ˆë‹¤.
     * @param id - ì´ë©”ì¼ ì •ë³´ë¡œ ì°¾ì€ ìœ ì € id
     * @param count - ì°¸ì—¬ ë¦¬ìŠ¤íŠ¸ì˜ size
     * @return - ìœ ì € id ì •ë³´ë¡¤ ì°¾ì€ ì¢‹ì•„ìš” ê°œìˆ˜ì™€ ì°¸ì—¬ ë¦¬ìŠ¤íŠ¸ì˜ ê°œìˆ˜ë¥¼ ë°›ì•„ í•„ìš”í•œ ì •ë³´ë§Œ ë§¤í•‘í•œ dto
     */
    private StaticsInfoDto getStatsByUserId(Long id, int count) {
        Long reviewCount = meetingReviewRepository.countReviewByUserId(id);
        return StaticsInfoDto.of(reviewCount, count);
    }

}
```

---

## ğŸ’­ 8/13 ì¼ íšŒê³ 
ë§ˆì´í˜ì´ì§€ì—ì„œ ë°›ì•„ì•¼ í•  ì •ë³´ê°€ ë§ì•„ ì²˜ìŒì— êµ¬ì¡°ì™€ ì²˜ë¦¬ ë°©ë²•ì„ ê³ ë¯¼í–ˆë‹¤.   
ë¯¸íŒ… í…Œì´ë¸”ì—ì„œ ì±… ì •ë³´ë¥¼ ë°›ì•„ì˜¬ ë•Œ API ëª…ì„¸ì„œì—ëŠ” ê°ì²´ í˜•íƒœì˜€ì§€ë§Œ ì±… ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” ì—”í„°í‹°ê°€ ì—†ê¸° ë•Œë¬¸ì— ë§µ íƒ€ì…ìœ¼ë¡œ ì²˜ë¦¬í–ˆë‹¤.   
ì±… ì •ë³´ëŠ” DTO ë‚´ì— ì„ ì–¸í•œ í° ë§µì•ˆì— ì±… ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆëŠ” ë§µì„ ë„£ì–´ ì—ëŸ¬ ì—†ì´ êµ¬í˜„í•  ìˆ˜ ìˆì—ˆë‹¤.   
ì„ í˜¸ ì¥ë¥´ì˜ ê²½ìš° ë³´í†µ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì—¬ëŸ¬ê°œë¥¼ ì„ íƒí•  ìˆ˜ ìˆì§€ë§Œ í˜„ì¬ ê°œë°œ ê¸°ê°„ ë‚´ì— êµ¬í˜„í•˜ê¸°ëŠ” ì¡°ê¸ˆ ë³µì¡í•  ê²ƒ ê°™ì•„ì„œ í•œ ê°œë§Œ ì„¤ì • ê°€ëŠ¥í•˜ë„ë¡ í•˜ê²Œ í•˜ê³  ë¬¸ìì—´ë¡œ ì²˜ë¦¬í–ˆë‹¤.

**í–¥í›„ ê°œì„ ì **
- ì±… ê´€ë ¨ ê¸°ëŠ¥ì„ í™•ì¥í•˜ë©´ì„œ Book ê°ì²´ë¥¼ ìƒì„±í•´ ê´€ë¦¬í•˜ë©´ ê¸°ëŠ¥ êµ¬í˜„ê³¼ ìœ ì§€ë³´ìˆ˜ê°€ ë” ê¹”ë”í•´ì§ˆ ê²ƒ ê°™ë‹¤.   
- ì„ í˜¸ ì¥ë¥´ë¥¼ ë³„ë„ì˜ í…Œì´ë¸”ë¡œ ê´€ë¦¬í•˜ë©´ ê°œì¸í™” ê¸°ëŠ¥ í™•ì¥ì— ìœ ë¦¬í•  ê²ƒ ê°™ë‹¤.