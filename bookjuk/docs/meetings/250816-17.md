# ğŸ“… 2025-08-16~17 íšŒê³ 

> **ë¶ì ë¶ì (BookJuk)** í”„ë¡œì íŠ¸ ë§ˆì´í˜ì´ì§€ í”„ë¡œí•„ ì •ë³´ ìˆ˜ì • dto êµ¬í˜„, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‘ì„±, api controller ì‘ì„±

## ğŸ§­ ì˜¤ëŠ˜ ë…¼ì˜í•œ ì£¼ìš” ë‚´ìš©
 
* ë§ˆì´í˜ì´ì§€ í”„ë¡œí•„ ì •ë³´ ìˆ˜ì • ê¸°ëŠ¥ êµ¬í˜„ì„ ìœ„í•œ dto, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, api controller ì‘ì„±

## ğŸš© ë‚´ì¼ ì‘ì—…í•  ë‚´ìš©

* ë§ˆì´í˜ì´ì§€ í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„
---

## âœ… ë§ˆì´í˜ì´ì§€ í”„ë¡œí•„ ì •ë³´ ìˆ˜ì • ë°±ì—”ë“œ ê¸°ëŠ¥ êµ¬í˜„
ë§ˆì´í˜ì´ì§€ í”„ë¡œí•„ ì •ë³´ ìˆ˜ì •ì€ ì´ë¯¸ì§€ì™€ ìˆ˜ì •ëœ ë‚´ìš©ì„ ë°›ì•„ì™€ì„œ dbì— ì €ì¥í•´ì•¼ ë˜ê¸°ë•Œë¬¸ì—   
ìˆ˜ì •í•œ ë‚´ìš©ì„ ë°›ì•„ì˜¤ëŠ” dtoë¥¼ ì‘ì„±í–ˆë‹¤. ìœ ì €ë„¤ì„, í”„ë¡œí•„ì´ë¯¸ì§€, ì„ í˜¸ì¥ë¥´, ìê¸°ì†Œê°œë¥¼ ì…ë ¥ë°›ì„ ìˆ˜ ìˆê³    
ìœ ì €ë„¤ì„ì€ í•„ìˆ˜ê°’ì´ì§€ë§Œ ìˆ˜ì •í•˜ì§€ ì•Šê³  ê¸°ì¡´ ìœ ì €ë„¤ì„ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.   
ìœ ì €ë„¤ì„ ê²€ì¦ì€ í”„ë¡ íŠ¸ì—ì„œ ì§„í–‰í•˜ê³  dto ì—ì„œëŠ” ìˆëŠ” ê²½ìš°ì— í•œí•´ì„œ ê°’ì„ ë°›ë„ë¡ ì‘ì„±í–ˆë‹¤.   
ìœ ì €ë„¤ì„ì„ ì œì™¸í•œ ë‹¤ë¥¸ ì…ë ¥ê°’ë“¤ì€ null ìƒíƒœë„ ë°›ì„ ìˆ˜ ìˆê²Œ ë§Œë“¤ì—ˆë‹¤.
```
dto
public class UpdateProfileRequest {

    @Size(max = 50, message = "ë‹‰ë„¤ì„ì€ 50ìë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
    private String username;

    @Nullable
    private String profileImage;

    @Nullable
    private String preferredGenre;

    @Nullable
    private String introduction;

}
```
User ì—”í„°í‹°ì— í¸ì˜ ë©”ì†Œë“œ ì¶”ê°€í•˜ì—¬ ìˆ˜ì •ëœ ë‚´ìš©ì„ ìœ ì €ê°ì²´ì— ë°˜ì˜í•  ìˆ˜ ìˆê²Œ ë§Œë“¤ì—ˆë‹¤.   
ì›ë˜ ìœ ì €ê°ì²´ëŠ” í† í°ì„ í†µí•´ ì•Œì•„ì˜¨ emailë¡œ ìœ ì €ê°ì²´ë¥¼ ê°€ì ¸ì˜¨ë‹¤. ê°€ì ¸ì˜¨ ìœ ì €ê°ì²´ì˜
í¸ì˜ ë©”ì†Œë“œ updateProfileì„ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œ ì…ë ¥ëœ í”„ë¡œí•„ ìˆ˜ì • ë‚´ìš©ì„ ë°˜ì˜í•  ìˆ˜ ìˆê²Œ í–ˆë‹¤.
username ì˜ ê²½ìš° ì—”í„°í‹° ìƒì„±ì‹œ nullable=falseë¡œ ì„ ì–¸í•˜ì—¬ nullì„ ë°›ì„ ìˆ˜ ì—†ê²Œ í•˜ê³    
í”„ë¡ íŠ¸ ë‹¨ì—ì„œë„ í•œ ë²ˆ ë” ê²€ì¦í•˜ë„ë¡ êµ¬í˜„í–ˆë‹¤.  
```
// í”„ë¡œí•„ ìˆ˜ì • í¸ì˜ ë©”ì†Œë“œ
    public void updateProfile(UpdateProfileRequest request, String profileImage) {
        this.username = request.getUsername();
        this.introduction = request.getIntroduction();
        this.preferredGenre = request.getPreferredGenre();

        // ì´ë¯¸ì§€ URL ì´ null ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì—…ë°ì´íŠ¸
        if (profileImage != null) {
            this.profileImage = profileImage;
        }
    }
```
Service ì—ì„œëŠ” ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬ë¥¼ ìœ„í•´ì„œ localFileService ë¥¼ ì£¼ì…ë°›ì•˜ë‹¤.   
MultipartFileë¡œ íŒŒì¼ì„ ë°›ì€ ë’¤ img íŒŒì¼ì¸ì§€ ê²€ì¦í•˜ê³  ì´ë¯¸ì§€ íŒŒì¼ì´ ë§ìœ¼ë©´   
ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ê³  Strongìœ¼ë¡œ ì €ì¥ìœ„ì¹˜ urlë¥¼ ë°˜í™˜í•œë‹¤.   
ì—…ë¡œë“œí•œ íŒŒì¼ì´ ì—†ìœ¼ë©´ localFileServiceì—ì„œ nullì„ ë°˜í™˜í•˜ëŠ”ë°   
urlë¥¼ ë¦¬í„´ë°›ëŠ” newImageê°€ nullì´ë©´(ì—…ë¡œë“œí•œ í”„ë¡œí•„ì´ë¯¸ì§€ê°€ ì—†ìŒ) ë””í´íŠ¸ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡   
if ë¡œ ê¸°ë³¸í”„ë¡œí•„ ì €ì¥ ìœ„ì¹˜ë¥¼ ì €ì¥í•˜ê²Œí–ˆë‹¤.    
service ë‹¨ì—ì„œ null ì²˜ë¦¬ë¥¼ í•´ì£¼ê³  ìˆì–´ user ì—”í„°í‹° í¸ì˜ë©”ì†Œë“œì—ì„œ ì´ë¯¸ì§€ null ì²˜ë¦¬ëŠ” í•„ìš”ì—†ì–´ë³´ì´ë‚˜   
í•œ ë²ˆë” ê²€ì¦í•  ìˆ˜ ìˆë„ë¡ ì‚­ì œí•˜ì§€ ì•Šê³  ìœ ì§€í•˜ê¸°ë¡œ í–ˆë‹¤.
```
service
public UpdateProfileResponse updateProfile(UpdateProfileRequest request, String email, MultipartFile file) {

        // 1. ì‚¬ìš©ì ì •ë³´ë¡œ ìœ ì € ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        User user = getUserByEmail(email);

        // 2. í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ
        String newImage = null;

        if (file != null && !file.isEmpty()) {

            try {
                // ì´ë¯¸ì§€ íŒŒì¼ì´ ì•„ë‹Œ ê²ƒì€ ìŠ¤í‚µ
                if (file.getContentType() == null || !file.getContentType().startsWith("image/")) {
                    throw new CustomException();
                }
                newImage = localFileService.uploadFile(file);
                log.info("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„±ê³µ: {}", newImage);

            } catch (Exception e) {
                log.error("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: {}", e.getMessage());
                throw new CustomException(ErrorCode.FILE_SIZE_EXCEEDED);
            }
        }

        // 3. ìœ ì € ê°ì²´ì— ì •ë³´ ìˆ˜ì •
        if(newImage == null) {
            newImage = "/images/defaultProfile.png";
        }
        user.updateProfile(request, newImage);

        // 4. ìˆ˜ì •ëœ ìœ ì €ì •ë³´ ì—…ë°ì´íŠ¸
        User updatedUser = userRepository.save(user);
        return UpdateProfileResponse.from(updatedUser);

    }

localFileService
public class LocalFileService implements FileService{

    // application.ymlì— ì„¤ì •í•œ 'file.upload.location' ê°’ì„ ìë™ìœ¼ë¡œ ì£¼ì…ë°›ìŠµë‹ˆë‹¤.
    @Value("${file.upload.location}")
    private String uploadPath;

    @Override
    public String uploadFile(MultipartFile file) throws IOException {
        // 1. íŒŒì¼ì´ ì „ì†¡ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ë¹„ì–´ìˆëŠ” ê²½ìš° nullì„ ë°˜í™˜í•©ë‹ˆë‹¤.
        if (file == null || file.isEmpty()) {
            return null;
        }

        // 2. ì—…ë¡œë“œ ê²½ë¡œì— í•´ë‹¹í•˜ëŠ” ë””ë ‰í„°ë¦¬ê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ìƒì„±í•©ë‹ˆë‹¤.
        File uploadDir = new File(uploadPath);
        if (!uploadDir.exists()) {
            boolean created = uploadDir.mkdirs();
            log.info("ì—…ë¡œë“œ ë””ë ‰í„°ë¦¬ ìƒì„±: {}, ì„±ê³µ ì—¬ë¶€: {}", uploadPath, created);
        }

        // 3. íŒŒì¼ëª… ì¤‘ë³µì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ê³ ìœ í•œ íŒŒì¼ëª…ì„ ìƒì„±í•©ë‹ˆë‹¤. (UUID ì‚¬ìš©)
        String originalFilename = file.getOriginalFilename();
        String storedFileName = createStoredFileName(originalFilename);

        // 4. ìµœì¢… ì €ì¥ ê²½ë¡œì™€ íŒŒì¼ëª…ì„ í•©ì³ íŒŒì¼ì„ ì„œë²„ì— ì €ì¥í•©ë‹ˆë‹¤.
        File destination = new File(uploadPath, storedFileName);
        file.transferTo(destination);
        log.info("íŒŒì¼ ì €ì¥ ì„±ê³µ: {}", destination.getAbsolutePath());

        // 5. ì›¹ì—ì„œ ì´ íŒŒì¼ì— ì ‘ê·¼í•  ë•Œ ì‚¬ìš©í•  URL ê²½ë¡œë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
        //    (WebConfig ì„¤ì •ì´ ì´ ê²½ë¡œë¥¼ ì‹¤ì œ íŒŒì¼ ìœ„ì¹˜ì™€ ë§¤í•‘í•´ì¤ë‹ˆë‹¤.)
        return "/uploads/" + storedFileName;
    }

    // ì›ë³¸ íŒŒì¼ëª…ì—ì„œ í™•ì¥ìë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
    private String extractExtension(String originalFilename) {
        try {
            int pos = originalFilename.lastIndexOf(".");
            return originalFilename.substring(pos + 1);
        } catch (StringIndexOutOfBoundsException e) {
            // í™•ì¥ìê°€ ì—†ëŠ” íŒŒì¼ì˜ ê²½ìš° ì²˜ë¦¬
            return "";
        }
    }

    // ì„œë²„ì— ì €ì¥ë  ê³ ìœ í•œ íŒŒì¼ëª…ì„ ìƒì„±í•©ë‹ˆë‹¤. (ì˜ˆ: a4e6-8b1e-11e9.png)
    private String createStoredFileName(String originalFilename) {
        String uuid = UUID.randomUUID().toString();
        String extension = extractExtension(originalFilename);
        return uuid + "." + extension;
    }

}
```
api controllerì—ì„œëŠ” ì´ë¯¸ì§€, json ë“± ì—¬ëŸ¬íƒ€ì…ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì•¼ í•´ì„œ ê¸°ì¡´ì— Post ìš”ì²­ì—ì„œ ì‚¬ìš©í•˜ë˜   
RequsetBody ëŒ€ì‹  RequsetPartë¥¼ ì‚¬ìš©í–ˆë‹¤.   
í•˜ë‚˜ì˜ APIì—ì„œ ì—¬ëŸ¬ íƒ€ì…ì˜ ë°ì´í„°ë¥¼ ë³´ë‚´ë ¤ë©´ multipart/form-dataë¥¼ ì‚¬ìš©í•œë‹¤.   
@RequestPartëŠ” multipart/form-data ìš”ì²­ì—ì„œ íŠ¹ì • partë¥¼ ë§¤í•‘í•´ì£¼ë©°,   
@RequestPart(name="â€¦")ì˜ nameì—ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚¼ ë•Œ ì‚¬ìš©í•˜ëŠ” key ê°’ì„ ì‘ì„±í•œë‹¤.   

ì•„ë˜ ì½”ë“œì—ì„œì²˜ëŸ¼ profileê³¼ imageFile ë‘ ê°€ì§€ ì´ë¦„ì„ ì‚¬ìš©í•˜ë©´,
- profile â†’ JSONìœ¼ë¡œ ë³€í™˜ë˜ì–´ DTOë¡œ ì²˜ë¦¬
- imageFile â†’ íŒŒì¼ë¡œ ì²˜ë¦¬ (MultipartFile)
  
multipart/form-dataì™€ RequsetPartë¥¼ ì‚¬ìš©í•˜ë©´ í•œ ìš”ì²­ ì•ˆì—ì„œ JSONê³¼ íŒŒì¼ì„ ë™ì‹œì— ë°›ì„ ìˆ˜ ìˆë‹¤.
```
@PutMapping("/profile")
    @ResponseBody
    public ResponseEntity<?> updateProfile(
            @RequestPart("profile") @Valid UpdateProfileRequest request
            ,@AuthenticationPrincipal String email
            ,@RequestPart(value = "imageFile", required = false) MultipartFile imageFile
            ) {

        UpdateProfileResponse response = myPageService.updateProfile(request, email, imageFile);
        log.info("ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • ì™„ë£Œ: {}", response.getUsername());
        return ResponseEntity.ok(ApiResponse.success("í”„ë¡œí•„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤", response));
    }
```
postmanìœ¼ë¡œ api í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í–ˆê³  ëª©í‘œì— ë§ê²Œ ê¸°ëŠ¥ì´ êµ¬í˜„ë¨ì„ í™•ì¸í–ˆë‹¤.

---

## ğŸ’­ 8/16~17 ì¼ íšŒê³ 
ì´ë¯¸ì§€ ì²˜ë¦¬ê°€ ìƒê°ë³´ë‹¤ ê¹Œë‹¤ë¡œì› ë‹¤. Postmanìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•  ë•Œ Content-Typeì„ application/jsonìœ¼ë¡œ ì§€ì •í•´ì•¼ í–ˆëŠ”ë°   
ì´ë¥¼ ê³„ì† descriptionë€ì— ì˜ëª» ì‘ì„±í•˜ëŠ” ë°”ëŒì— ì˜¤ë¥˜ê°€ ë°˜ë³µì ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ì‹¤ìˆ˜ë¥¼ í–ˆë‹¤.   
ë˜ ì•„ì‰¬ì› ë˜ ì ì€ í•™ì›ì—ì„œ ì§„í–‰í–ˆë˜ í† ì´ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì´ë¯¸ì§€ íŒŒì¼ ì €ì¥ ê²½ë¡œë¥¼ usernameë³„ë¡œ êµ¬ë¶„í•˜ë„ë¡ êµ¬í˜„í–ˆëŠ”ë°   
ì´ë²ˆì—ëŠ” ê·¸ ë¶€ë¶„ì„ ìƒëµí•œ ì±„ ë‹¨ìˆœíˆ ì—…ë¡œë“œ ê¸°ëŠ¥ë§Œ êµ¬í˜„í–ˆë‹¤.   
ì‚¬ìš©ìë³„ ê²½ë¡œ ë§¤í•‘ì„ ì ìš©í•˜ì§€ ëª»í•œ ë¶€ë¶„ì´ ì•„ì‰¬ì› ë‹¤.   
ë‹¤ìŒ í”„ë¡œì íŠ¸ì—ì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œë¥¼ êµ¬í˜„í•  ë•Œì—ëŠ” ë°˜ë“œì‹œ userë³„ ê²½ë¡œ ë§¤í•‘ì„ ì ìš©í•´ë³´ê³  ì‹¶ë‹¤. 


