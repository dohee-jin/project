# π“… 2025-08-12 νκ³ 

> **λ¶μ λ¶μ (BookJuk)** ν”„λ΅μ νΈ μΆ‹μ•„μ” κΈ°λ¥ λΉ„μ¦λ‹μ¤ λ΅μ§ μ‘μ„±, ν…μ¤νΈ

## π§­ μ¤λ λ…Όμν• μ£Όμ” λ‚΄μ©

* μΆ‹μ•„μ” κΈ°λ¥ κµ¬ν„μ„ μ„ν• service μ½”λ“ μ‘μ„± λ° ν…μ¤νΈ

## π© λ‚΄μΌ μ‘μ—…ν•  λ‚΄μ©

* μΆ‹μ•„μ” κΈ°λ¥ κµ¬ν„ μ»¨νΈλ΅¤λ¬ μ‘μ„±
* λ§μ΄νμ΄μ§€ κΈ°λ¥ κµ¬ν„μ„ μ„ν• dto, service μ‘μ—… μ‹μ‘

---

## β… review(μΆ‹μ•„μ”) κΈ°λ¥ κµ¬ν„ μ‘μ—… 

**μΆ‹μ•„μ” λ‚¨κΈ°κΈ°(λ°›κΈ°)** λΉ„μ¦λ‹μ¤ λ΅μ§
1. λ―Έν… μ •λ³΄ ν™•μΈ
    - λ―Έν… idλ΅ ν•΄λ‹Ή λ―Έν…μ΄ μ΅΄μ¬ν•λ” μ§€ ν™•μΈ
    - λ―Έν…μ μΆ…λ£ μ—¬λ¶€λ¥Ό ν™•μΈν•λ‹¤.
    - λ‘ μ΅°κ±΄μ„ λ§μ΅±ν•λ©΄ μ μ € μ΅°κ±΄μ„ ν™•μΈν•λ‹¤.
2.  μ μ € μ •λ³΄ ν™•μΈ
    - reviewer, revieweeκ°€ λ―Έν…μ— μ°Έμ—¬μ¤‘μΈμ§€ ν™•μΈν•λ‹¤.
    - reviewerμ™€ reiveweeμ idκ°€ μ„λ΅ λ‹¤λ¥Έμ§€ ν™•μΈν•λ‹¤.
    - λ‘ μ΅°κ±΄μ„ λ§μ΅±ν•λ©΄ μΆ‹μ•„μ”λ¥Ό λ‚¨κΈΈμ(λ°›μ„μ) μλ‹¤.
3. μμ™Έ λ°μƒ μ΅°κ±΄ ν™•μΈ
    - μ΅΄μ¬ν•μ§€ μ•μ€ λ―Έν…μΌ λ•
    - μΆ…λ£λμ§€ μ•μ€ λ―Έν…μΌ λ•
    - λ―Έν…μ— μ°Έμ—¬ν•μ§€ μ•μ€ μ μ €μΌ λ•
    - λ¦¬λ·°λ¥Ό λ‚¨κΈ°λ” μ μ €μ™€ λ°›λ” μ μ €κ°€ λ™μΌν•  λ•
    - μ¤‘λ³µμΌλ΅ μΆ‹μ•„μ”λ¥Ό λ„λ¥΄λ ¤κ³  ν•  λ•   

**QueryDsl λΉλ“ κ·Έλμ΄λ“¤ μμ΅΄μ„± μ£Όμ…**
```
// QueryDSL μμ΅΄μ„± μ¶”κ°€
    implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta'
    annotationProcessor 'com.querydsl:querydsl-apt:5.0.0:jakarta'
    annotationProcessor 'jakarta.annotation:jakarta.annotation-api:2.1.1'
    annotationProcessor 'jakarta.persistence:jakarta.persistence-api:3.1.0'
```

**QueryDsl μ‚¬μ©μ„ μ„ν• μ„¤μ •νμΌ μƒμ„±**
```
@Configuration
@RequiredArgsConstructor
public class QueryDslConfig {

    private final EntityManager em;

    @Bean
    public JPAQueryFactory factory() {
        return new JPAQueryFactory(em);
    }

}
```

**repository 3λ‹¨κ³„ λ¶„λ¦¬**   
QueryDsl μ‚¬μ©μ„ μ„ν•΄   
κΈ°λ³Έ Repository μΈν„°νμ΄μ¤ / μ»¤μ¤ν…€ Repository μΈν„°νμ΄μ¤ / μ»¤μ¤ν…€ κµ¬ν„ λ¦¬ν¬μ§€ν† λ¦¬ ν΄λμ¤ 3κ° νμΌλ΅ λ¶„λ¦¬ν–λ‹¤.   


λ―Έν… idλ΅ μ‚¬μ©μλ¥Ό μ°ΎκΈ°μ„ν•΄ MeetingParticipantRepository μ— μ»¤μ¤ν…€ λ¦¬ν¬μ§€ν† λ¦¬μ™€ λ©”μ†λ“λ¥Ό μ‘μ„±ν•κ³    
κµ¬ν„ λ¦¬ν¬μ§€ν† λ¦¬μ— μ•„λ λ‚΄μ©μ„ μ‘μ„±ν–λ‹¤.
```
    // queryDslμ„ μ‚¬μ©ν•κΈ° μ„ν• μμ΅΄κ°μ²΄
    // QueryDslConfig νμΌμ—μ„ μ„¤μ •
    private final JPAQueryFactory factory;

    // λ―Έν… idλ΅ μ°Έμ—¬μ μ°ΎκΈ°
    @Override
    public List<User> findMeetingParticipantsByMeetingId(Long id) {
        return factory
                .select(meetingParticipant.participant)
                .from(meetingParticipant)
                .where(meetingParticipant.meeting.id.eq(id))
                .fetch();
    }
```
λ―Έν… idλ¥Ό κ²€μƒ‰ν•μ—¬ μ°Έμ—¬μ μ •λ³΄λ¥Ό λ¦¬μ¤νΈλ΅ λ°ν™, λ°ν™λ λ¦¬μ¤νΈλ” service λ‹¨μ—μ„    
reviewerId, revieweeId μ™€ userIdλ¥Ό λΉ„κµν•μ—¬ μ°Έμ—¬μμΈμ§€ ν™•μΈν•λ‹¤.   


λ¦¬λ·° μ¤‘λ³µμ„ λ°©μ§€ν•κΈ° μ„ν•΄ MeetingReviewRepositoryμ— μ»¤μ¤ν…€ λ¦¬ν¬μ§€ν† λ¦¬μ™€ λ©”μ†λ“λ¥Ό μ‘μ„±ν•κ³    
κµ¬ν„ λ¦¬ν¬μ§€ν† λ¦¬μ— μ•„λ λ‚΄μ©μ„ μ‘μ„±ν–λ‹¤.
```
@RequiredArgsConstructor
public class MeetingReviewRepositoryImpl implements MeetingReviewCustomRepository {

    // queryDslμ„ μ‚¬μ©ν•κΈ° μ„ν• μμ΅΄κ°μ²΄
    private final JPAQueryFactory factory;

    @Override
    public boolean existDuplicateReview(Meeting meeting, User reviewer, User reviewee) {
        return factory
                .selectFrom(meetingReview)
                .where(meetingReview.meeting.eq(meeting)
                        .and(meetingReview.reviewer.eq(reviewer))
                        .and(meetingReview.reviewee.eq(reviewee))
                )
                .fetchOne() != null ? true : false;

    }
}
```
κ°™μ€ λ―Έν…μ—μ„ λ¦¬λ·°μ–΄μ™€ λ¦¬λ·°μ΄μ—κ² μΆ‹μ•„μ”λ¥Ό λ„λ¥΄λ©΄ μ •λ³΄κ°€ λ―Έν…λ¦¬λ·° ν…μ΄λΈ”μ— μ €μ¥λλ‹¤.   
λ‹¤μ‹ λ™μΌν• λ―Έν…μ—μ„ μΆ‹μ•„μ”λ¥Ό μ¤‘λ³µμΌλ΅ λ„λ¥΄λ” κ²ƒμ„ λ°©μ§€ν•κΈ° μ„ν•΄ μ΄λ―Έ μ΅΄μ¬ν• λ¦¬λ·°κ°€ μλ”μ§€ ν™•μΈν•κ³    
μ΅΄μ¬ν•λ” λ¦¬λ·°κ°€ μλ‹¤λ©΄ trueλ¥Ό λ°ν™ν•κ³  μ—†μΌλ©΄ falseλ¥Ό λ°ν™ν•λ‹¤.   
λ°ν™λλ” κ°’μ΄ true (μ΄λ―Έ λ¦¬λ·°κ°€ μ΅΄μ¬) λ©΄ μμ™Έμ²λ¦¬λ¥Ό μ§„ν–‰ν•λ‹¤.   

**λ¦¬λ·° κ΄€λ ¨ μμ™Έ μ¶”κ°€**   
λ‹¤λ¥Έ ν€μ›λ¶„μ΄ λ§λ“¤μ–΄ λ‘μ‹  μ»¤μ¤ν…€ μμ™Έ μ—λ¬ μ½”λ“ μ΄λ„νμΌμ— μ—λ¬ μ½”λ“λ¥Ό μ¶”κ°€ν–λ‹¤.
```
// =========================
    // β¤οΈ μΆ‹μ•„μ” / ν›„κΈ° κ΄€λ ¨
    // =========================
    MEETING_NOT_COMPLETED("MEETING_NOT_COMPLETED", "λ―Έν…μ΄ μ™„λ£λμ§€ μ•μ•μµλ‹λ‹¤.", 400),
    DUPLICATE_LIKE("DUPLICATE_LIKE", "μΆ‹μ•„μ”λ” μµλ€ ν• λ²λ§ λ„λ¥Ό μ μμµλ‹λ‹¤.", 400),
    LIKE_SELF_NOT_ALLOWED("LIKE_SELF_NOT_ALLOWED", "μκΈ° μμ‹ μ„ μΆ‹μ•„μ”ν•  μ μ—†μµλ‹λ‹¤.", 400),
    USER_NOT_PARTICIPANT("USER_NOT_PARTICIPANT", "ν•΄λ‹Ή μ‚¬μ©μλ” λ¨μ„ μ°Έμ—¬μκ°€ μ•„λ‹™λ‹λ‹¤.", 400),
```

---

## β… review(μΆ‹μ•„μ”) κΈ°λ¥ ν…μ¤νΈ
μΈν…”λ¦¬μ μ΄μ—μ„ μ κ³µν•λ” ν…μ¤νΈ λ„κµ¬ Junitμ„ ν™μ©ν•μ—¬ TDD(given-when-then) μ¤νƒ€μΌλ΅ MeetingRepository,   MeetingParticipantRepository, MeetingReviewRepository, MeetingReviewServiceλ¥Ό JPAλ¥Ό μ΄μ©ν•μ—¬ κ°„λ‹¨ν• CRUD ν…μ¤νΈλ¥Ό μ§„ν–‰   
λ”λ―Έ μ μ €, λ”λ―Έ λ―Έν…, λ”λ―Έ λ―Έν… μ°Έμ—¬ μ •λ³΄λ” λ―Έν… μ°Έμ—¬ ν…μ¤νΈ μ‹ ν€μ›λ¶„μ΄ μ‘μ„±ν•μ‹  μ½”λ“λ¥Ό ν™μ©ν•μ—¬ ν…μ¤νΈλ¥Ό μ§„ν–‰ν–λ‹¤. 
```
 // ========== MeetingReviewRepository: CREATE ==========
    @Test
    @DisplayName("λ¨μ„μ΄ μΆ…λ£λ ν›„ λ‹¤λ¥Έ μ‚¬μ©μμ—κ² λ¦¬λ·°(μΆ‹μ•„μ”)λ¥Ό λ‚¨κΈ΄λ‹¤")
    void createReview() {
        // given
        Long meetingId =  m1.getId();
        Long reviewerId = u2.getId();
        Long revieweeId = u3.getId();

        // when
        ReviewResponse response = reviewService.createReview(meetingId, reviewerId, revieweeId);

        // then
        System.out.println("response = " + response);
    }
```
---

## π’­ 8/12 μΌ νκ³ 
μΆ‹μ•„μ” κΈ°λ¥μ μ£Όμ” κΈ°λ¥μ„ μ™„μ„±ν–λ‹¤. λ¶μ λ¶μ  λ…μ„ λ¨μ„ μ„λΉ„μ¤ ν”λ΅μ°μ™€ κΈ°λ¥ λ…μ„Έμ„λ¥Ό κ°λ° μ „μ— μƒμ„Έν μ‘μ„±ν•λ‹   
ν•„μ”ν• κΈ°λ¥μ΄ λ¬΄μ—‡μΈμ§€ λΉ λ¥Έ νλ‹¨μ΄ κ°€λ¥ν–κ³  ν° λ¬Έμ  μ—†μ΄ μΆ‹μ•„μ” κΈ°λ¥μ„ κµ¬ν„ν•  μ μμ—λ‹¤.   
νΈλ¬λΈ”μν…μ΄λΌκ³  ν•  μ •λ„μ λ¬Έμ λ” λ°μƒν•μ§€ μ•μ•μΌλ‚ ν…μ¤νΈ μ‹ db μΉΌλΌλ…κ³Ό λ”λ―Έλ΅ κµ¬ν„ν• μ μ € μ—”ν‹°ν‹°κ°„μ ν•„λ“λ…μ΄   
μƒμ΄ν•μ—¬ ν…μ¤νΈ μ‹ SQLexceptionμ΄ λ–΄λ‹¤.   
ν…μ¤νΈ μ‹ μ μ € μ—”ν‹°ν‹°λ” μ•„μ§ κµ¬ν„ μ „μ΄λΌ ν…μ¤νΈμ©μΌλ΅ μ‘μ„±ν–λ‹¤λ” λ‹¤λ¥Έ ν€μ›λ¶„μ λ‹µμ„ λ“£κ³  μΆ‹μ•„μ” κΈ°λ¥ ν…μ¤νΈμ— ν•„μ”ν•  
λ‚΄μ©μΌλ΅ μμ •ν•μ—¬ ν…μ¤νΈλ¥Ό μ™„λ£ν–λ‹¤.   

μ•„λμ λ‚΄μ©μ€ MeetingReview μ—”ν‹°ν‹°μ™€ μ‘μ„±ν•λ©΄μ„ λ‹¤μ‹ λ³µμµν•κ² λ λ‚΄μ©μ΄λ‹¤.   
- mappedBy κ°’μ€ μ—°κ΄€ λ€μƒ μ—”ν‹°ν‹°μ ν•„λ“ μ΄λ¦„(κ°μ²΄ ν•„λ“λ…) μ„ κ°€λ¦¬μΌμ•Ό ν•λ‹¤.
- JPAκ°€ @JoinColumnμΌλ΅ μ—°κ²°λ ν•„λ“μ—μ„ μλ™μΌλ΅ μ™Έλν‚¤(id)λ¥Ό λ‹¤λ£¨κΈ° λ•λ¬Έμ— μ—°κ΄€κ΄€κ³„μ—μ„λ” κ°μ²΄λ΅ μ—°κ΄€κ΄€κ³„λ¥Ό λ§Ίλ”λ‹¤.

